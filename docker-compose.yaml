services:
  app:
    build: .
    container_name: bluettique-app
    network_mode: "host"   # Keeps BLE/dbus compatibility; 1883/5000 exposed on host
    pid: "host"            # Share PID ns so BlueZ sees same processes
    privileged: true
    devices:
      - /dev/ttyAMA0:/dev/ttyAMA0
    volumes:
      - ./logs:/app/logs
      - /var/run/dbus:/var/run/dbus   # share host system bus (bluez)
      - /var/lib/bluetooth:/var/lib/bluetooth
      - /sys/class/bluetooth:/sys/class/bluetooth
      - /dev:/dev
      - .env:/app/.env
      - /etc/machine-id:/etc/machine-id:ro  # match host dbus creds
    environment:
      - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/var/run/dbus/system_bus_socket
    restart: unless-stopped
